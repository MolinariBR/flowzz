# Prompt: `tests.md`

## Foco: **Usar Testes para Validar e Corrigir C√≥digo de Produ√ß√£o**

**Objetivo:** Executar testes para **identificar e corrigir erros no c√≥digo de produ√ß√£o** baseado na documenta√ß√£o do projeto.

---

## ‚ö° MODO DE OPERA√á√ÉO

### üéØ Pipeline Autom√°tico

**Executar automaticamente:** `mapear` ‚Üí `executar` ‚Üí `comparar` ‚Üí `corrigir` ‚Üí `analisar` ‚Üí `validar`

**Prioridade de Decis√£o:**
1. **üìö Documenta√ß√£o /zed = FONTE DA VERDADE**
2. **üíª C√≥digo de Produ√ß√£o = DEVE SER CORRIGIDO** (se n√£o atende docs)
3. **üß™ Testes = FERRAMENTA DE VALIDA√á√ÉO** (para detectar erros no c√≥digo)

**Sa√≠da:** Apenas 1 relat√≥rio consolidado final no chat (sem artefatos intermedi√°rios)

### ‚ùå NUNCA / ‚úÖ SEMPRE

**‚ùå NUNCA:**
- Assumir que teste est√° errado sem comparar com docs
- Corrigir c√≥digo sem validar contra /zed
- Criar artefatos intermedi√°rios
- Pausar pipeline entre etapas

**‚úÖ SEMPRE:**
- Documenta√ß√£o /zed √© a fonte da verdade
- Comparar: Docs ‚Üí C√≥digo ‚Üí Teste
- Priorizar corre√ß√£o do c√≥digo de produ√ß√£o
- Executar pipeline completo automaticamente
- Apresentar apenas relat√≥rio final consolidado

---

## üìö Documentos Obrigat√≥rios (Fonte da Verdade)

1. **plan.md** - Objetivos, m√©tricas, personas
2. **design.md** - Stack, padr√µes, cobertura m√≠nima
3. **tasks.md** - Tasks, crit√©rios t√©cnicos
4. **user-stories.md** - Cen√°rios Gherkin, crit√©rios funcionais
5. **user-journeys.md** - Contexto emocional, touchpoints
6. **dev-stories.md** - Implementa√ß√£o, estrutura, exemplos
7. **openapi.yaml** - Contratos API, schemas, endpoints

---

## üîÑ Pipeline (Processamento Interno)

### 1. `mapear` üó∫Ô∏è

**Processar:** Documenta√ß√£o ‚Üí C√≥digo ‚Üí Testes
**Coletar:** Matriz de rastreabilidade, gaps de implementa√ß√£o, c√≥digo √≥rf√£o, teste √≥rf√£o

### 2. `executar` ‚ñ∂Ô∏è

**Processar:** Rodar testes (unit/integration/e2e), capturar falhas, calcular cobertura
**Coletar:** Falhas detalhadas (erro no c√≥digo?), cobertura vs meta, √°reas n√£o testadas

### 3. `comparar` üîç

**Para cada falha:**
1. Analisar docs: comportamento esperado (user-stories/tasks/openapi)
2. Analisar c√≥digo: implementa docs?
3. Analisar teste: valida comportamento correto?
4. Diagnosticar: **CASO A** (erro c√≥digo) / **CASO B** (erro teste) / **CASO C** (ambos) / **CASO D** (docs amb√≠guas)

**Coletar:** Diagn√≥stico (A/B/C/D), proposta de corre√ß√£o, prioriza√ß√£o (P0/P1/P2)

### 4. `corrigir` üîß

**CASO A (mais comum):** Corrigir c√≥digo de produ√ß√£o para atender docs
**CASO B:** Corrigir teste que valida comportamento errado
**CASO C:** Corrigir ambos

**Validar:** Re-executar teste, confirmar passa, sem regress√£o

**Coletar:** Corre√ß√µes aplicadas (antes/depois), valida√ß√µes, impacto

### 5. `analisar` üìä

**Processar:**
- Conformidade c√≥digo ‚Üî docs (%)
- Problemas de qualidade no c√≥digo (anti-patterns, code smells)
- Gaps de cobertura cr√≠ticos

**Coletar:** Score conformidade, problemas P0/P1/P2, recomenda√ß√µes

### 6. `validar` ‚úÖ

**Processar checklist:**
- C√≥digo implementa docs? (plan/design/tasks/stories/openapi)
- Qualidade OK? (SOLID, manuten√≠vel, error handling)
- Testes passam? Cobertura >= meta?
- Rastreabilidade completa?

**Coletar:** Score final, classifica√ß√£o, decis√£o (APROVADO/RESSALVAS/REPROVADO), a√ß√µes obrigat√≥rias

---

## üìä Relat√≥rio Consolidado Final

**√öNICA sa√≠da apresentada ap√≥s completar 6 etapas:**

```markdown
## üìä VALIDA√á√ÉO DE C√ìDIGO VIA TESTES

**Projeto:** [nome] | **Data:** [timestamp]

---

### üéØ DECIS√ÉO FINAL

**Status:** [‚úÖ APROVADO / ‚ö†Ô∏è RESSALVAS / ‚ùå REPROVADO]

**Justificativa:** [An√°lise conformidade + qualidade + testes]

---

### üìä M√âTRICAS

| M√©trica                    | Valor  | Meta   | Status  |
|----------------------------|--------|--------|---------|
| Testes Passando            | [X/Y]  | [Y]    | [‚úÖ/‚ùå] |
| Cobertura C√≥digo           | [X]%   | [Z]%   | [‚úÖ/‚ùå] |
| Conformidade Docs          | [X]%   | 100%   | [‚úÖ/‚ùå] |
| User Stories Implementadas | [X/Y]  | [Y]    | [‚úÖ/‚ùå] |
| Crit√©rios Tasks Atendidos  | [X/Y]  | [Y]    | [‚úÖ/‚ùå] |
| Endpoints Conformes        | [X/Y]  | [Y]    | [‚úÖ/‚ùå] |
| Score Qualidade            | [X]%   | 75%    | [‚úÖ/‚ùå] |

---

### üó∫Ô∏è MAPEAMENTO: DOCS ‚Üí C√ìDIGO ‚Üí TESTES

**User Stories vs C√≥digo vs Testes:**
| Story | Docs | C√≥digo | Testes | Status | Gap                      |
|-------|------|--------|--------|--------|--------------------------|
| 1.1   | ‚úÖ   | ‚úÖ     | ‚úÖ     | ‚úÖ     | -                        |
| 1.2   | ‚úÖ   | ‚ùå     | ‚ùå     | ‚ùå     | C√≥digo n√£o implementado  |
| 1.3   | ‚úÖ   | ‚úÖ     | ‚ö†Ô∏è     | ‚ö†Ô∏è     | Teste incompleto         |

**Tasks vs C√≥digo vs Testes:**
| Task | Crit√©rios | C√≥digo Atende | Testado | Status |
|------|-----------|---------------|---------|--------|
| 1.1  | 5         | 4/5 (80%)     | 3/5     | ‚ö†Ô∏è     |
| 1.2  | 3         | 3/3 (100%)    | 3/3     | ‚úÖ     |

**Endpoints vs C√≥digo vs Testes:**
| Endpoint   | M√©todo | Implementado | Status Codes | Testado | Status |
|------------|--------|--------------|--------------|---------|--------|
| /api/users | GET    | ‚úÖ           | 200,404      | ‚úÖ      | ‚úÖ     |
| /api/auth  | POST   | ‚úÖ           | 200,401      | ‚ùå      | ‚ö†Ô∏è     |

**Gaps:**
- üî¥ P0: [X] stories n√£o implementadas, [Y] crit√©rios n√£o atendidos, [Z] endpoints faltando
- üü° P1: [X] comportamentos sem teste, [Y] edge cases descobertos
- üü¢ P2: [X] melhorias de nomenclatura

---

### ‚ñ∂Ô∏è EXECU√á√ÉO DE TESTES

**Status:** [‚úÖ/‚ö†Ô∏è/‚ùå] | ‚úÖ [X] passou ([Y]%) | ‚ùå [Z] falhou ([W]%) | Tempo: [T]s

**Cobertura:** (meta: [M]% - design.md)
- Linhas: [X]% | Branches: [Y]% | Fun√ß√µes: [Z]%
- Status: [‚úÖ Atingiu / ‚ùå Abaixo]

**Falhas Detectadas:**

**#1: [Nome teste]**
- Teste: `tests/[caminho:linha]` | C√≥digo: `src/[caminho:linha]`
- Ref: user-stories.md [X.Y], tasks.md [X.Y]
- Erro: [stack trace resumido]
- Esperado: [comportamento docs] | Recebido: [comportamento c√≥digo]
- Diagn√≥stico: [‚ùå ERRO NO C√ìDIGO / ‚ùå ERRO NO TESTE / ‚ùå AMBOS]

---

### üîç DIAGN√ìSTICO DETALHADO

**Falha #1: [Nome]**

**üìã Docs (Comportamento Esperado):**
- user-stories.md [X.Y]: `Given [x] When [y] Then [z]`
- tasks.md [X.Y]: "[crit√©rio]"
- openapi.yaml: [endpoint] ‚Üí [m√©todo] ‚Üí [status] ‚Üí [schema]

**üíª C√≥digo Atual:**
```typescript
[c√≥digo relevante - 10 linhas]
```
- ‚ùå N√ÉO implementa comportamento documentado
- Problema: [discrep√¢ncia espec√≠fica]

**üß™ Teste Atual:**
```typescript
[teste - 10 linhas]
```
- [‚úÖ Correto / ‚ùå Incorreto] (valida comportamento [correto/errado])

**üéØ Diagn√≥stico:**
- Fonte: [‚ùå C√ìDIGO / ‚ùå TESTE / ‚ùå AMBOS]
- Raz√£o: [explica√ß√£o t√©cnica da discrep√¢ncia docs vs c√≥digo vs teste]

---

### üîß CORRE√á√ïES APLICADAS

**#1: [Falha]** | Tipo: [C√≥digo/Teste/Ambos] | `[arquivo]`

**üî¥ ANTES:**
```typescript
[c√≥digo/teste incorreto]
```

**üü¢ DEPOIS:**
```typescript
[c√≥digo/teste corrigido]
```

**Mudan√ßas:** Linha [X]: [descri√ß√£o]
**Justificativa:** [raz√£o - ref aos docs]
**Valida√ß√£o:** ‚úÖ Teste passou | ‚úÖ Alinha user-stories.md [X.Y] | ‚úÖ Atende tasks.md [X.Y] | ‚úÖ Sem regress√£o

**Impacto Geral:**
- Antes: ‚úÖ [X] passando | ‚ùå [Y] falhando | [Z]% cobertura
- Depois: ‚úÖ [X+W] passando | ‚ùå [Y-W] falhando | [Z+V]% cobertura
- Melhoria: +[W] testes | +[V]% cobertura

---

### üìä AN√ÅLISE DE QUALIDADE DO C√ìDIGO

**Conformidade C√≥digo ‚Üî Docs:**
| Documento      | Conformidade | Gaps | Status  |
|----------------|--------------|------|---------|
| plan.md        | [X]%         | [Y]  | [‚úÖ/‚ùå] |
| design.md      | [X]%         | [Y]  | [‚úÖ/‚ùå] |
| tasks.md       | [X]%         | [Y]  | [‚úÖ/‚ùå] |
| user-stories   | [X]%         | [Y]  | [‚úÖ/‚ùå] |
| openapi.yaml   | [X]%         | [Y]  | [‚úÖ/‚ùå] |

**M√©dia:** [X]%

**Problemas de Qualidade no C√≥digo:**

**üî¥ P0 - Bloqueadores:**
1. [Problema] - `src/[arquivo:linha]` - [descri√ß√£o] - [corre√ß√£o]

**üü° P1 - Alta:**
2. [Problema] - `src/[arquivo:linha]` - [descri√ß√£o] - [corre√ß√£o]

**üü¢ P2 - Melhorias:**
3. [Problema] - `src/[arquivo:linha]` - [descri√ß√£o]

**Cobertura:**
- √Åreas cr√≠ticas descobertas: `src/[arquivo]` - [X]% (esperado: [Y]%)
- Happy paths: [X/Y] ([Z]%) | Edge cases: [X/Y] ([Z]%) | Error handling: [X/Y] ([Z]%)

---

### ‚úÖ VALIDA√á√ÉO FINAL

**Checklist:**

**Conformidade C√≥digo** ([X/8])
- [ ] Implementa plan.md
- [ ] Segue design.md (stack/padr√µes)
- [ ] Cobertura >= meta ([X]% >= [Y]%)
- [ ] Atende tasks.md ([X/Y])
- [ ] Implementa user-stories.md ([X/Y])
- [ ] Respeita openapi.yaml ([X/Y])
- [ ] Endpoints corretos
- [ ] Schemas validados

**Qualidade C√≥digo** ([X/6])
- [ ] Sem anti-patterns P0
- [ ] Segue SOLID
- [ ] Leg√≠vel/manuten√≠vel
- [ ] Error handling OK
- [ ] Performance OK
- [ ] Sem code smells graves

**Valida√ß√£o Testes** ([X/7])
- [ ] Todos passam ([X/Y])
- [ ] Sem skipped
- [ ] Cobertura >= meta
- [ ] Happy paths: 100%
- [ ] Edge cases: >= 80%
- [ ] Error cases: >= 80%
- [ ] Sem flaky

**Rastreabilidade** ([X/4])
- [ ] Stories t√™m c√≥digo
- [ ] Tasks atendidas
- [ ] Endpoints implementados
- [ ] C√≥digo rastre√°vel

**Score:** [X/25] ([Y]%)

**Classifica√ß√£o:**
- 90-100%: ‚úÖ EXCELENTE
- 75-89%: ‚úÖ BOM
- 60-74%: ‚ö†Ô∏è ACEIT√ÅVEL
- < 60%: ‚ùå INSUFICIENTE

**Status:** [‚úÖ/‚ö†Ô∏è/‚ùå] [CLASSIFICA√á√ÉO]

---

### üìã RESUMO EXECUTIVO

**‚úÖ Fortes:**
1. [Aspecto positivo 1 com m√©trica]
2. [Aspecto positivo 2 com m√©trica]
3. [Aspecto positivo 3 com m√©trica]

**‚ö†Ô∏è Aten√ß√£o:**
1. [Aspecto aten√ß√£o 1]
2. [Aspecto aten√ß√£o 2]
3. [Aspecto aten√ß√£o 3]

**‚ùå Cr√≠ticos:**
1. [Bloqueador 1] - **IMPEDE APROVA√á√ÉO**
2. [Bloqueador 2] - **IMPEDE APROVA√á√ÉO**

---

### üéØ A√á√ïES OBRIGAT√ìRIAS

**P0 - Bloqueadores (OBRIGAT√ìRIO):**
1. [ ] [A√ß√£o cr√≠tica no c√≥digo 1]
2. [ ] [A√ß√£o cr√≠tica no c√≥digo 2]

**P1 - Alta (RECOMENDADO):**
1. [ ] [A√ß√£o importante 1]
2. [ ] [A√ß√£o importante 2]

**P2 - Melhorias (OPCIONAL):**
1. [ ] [Melhoria 1]
2. [ ] [Melhoria 2]

---

### ‚úÖ DECIS√ÉO E PR√ìXIMOS PASSOS

**C√≥digo Aprovado:** [‚úÖ SIM / ‚ö†Ô∏è SIM com ressalvas / ‚ùå N√ÉO]

**Justificativa:** [An√°lise conformidade + qualidade + cobertura + alinhamento docs]

**Pr√≥ximos Passos:**

**Se ‚úÖ APROVADO:**
1. Deploy em [ambiente]
2. Monitorar m√©tricas plan.md
3. Manter cobertura >= [meta]%

**Se ‚ö†Ô∏è RESSALVAS:**
1. Corrigir P1 antes de produ√ß√£o
2. Re-executar valida√ß√£o
3. Monitorar pontos de aten√ß√£o

**Se ‚ùå REPROVADO:**
1. Corrigir TODOS P0
2. Implementar stories faltantes
3. Atender crit√©rios tasks.md
4. Re-executar valida√ß√£o completa

---

### üìà HIST√ìRICO

**Anterior:** [data] | Score [X]% | [Y] passando | [Z]% cobertura | [status]
**Atual:** [data] | Score [X]% | [Y] passando | [Z]% cobertura | [status]
**Tend√™ncia:** [üìà/üìâ/‚û°Ô∏è] ([+/-X]%)

---

**Relat√≥rio autom√°tico - Valida√ß√£o C√≥digo via Testes**
**Base: docs /zed + testes + an√°lise c√≥digo**
```

---

## üéØ GARANTIAS

‚úÖ C√≥digo implementa TODA documenta√ß√£o /zed
‚úÖ C√≥digo atende crit√©rios tasks.md
‚úÖ C√≥digo implementa cen√°rios user-stories.md
‚úÖ C√≥digo respeita contratos openapi.yaml
‚úÖ Testes passam (validam comportamento correto)
‚úÖ Cobertura >= meta
‚úÖ Sem problemas P0 no c√≥digo
‚úÖ Rastreabilidade completa
‚úÖ Decis√£o clara: APROVADO/RESSALVAS/REPROVADO
‚úÖ A√ß√µes espec√≠ficas para corre√ß√µes

---

**Pipeline:** `mapear` ‚Üí `executar` ‚Üí `comparar` ‚Üí `corrigir` ‚Üí `analisar` ‚Üí `validar` üöÄ